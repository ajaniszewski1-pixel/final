<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Planer Bud≈ºetu - Django</title>
    <style>
        :root {
            --sheet-green: #13734e;
            --light-green: #e6f4ea;
            --border-color: #dadce0;
            --income-blue: #185abc;
            --expense-red: #d93025;
            --text-dark: #202124;
        }

        html, body {
            height: 100vh; margin: 0; padding: 0;
            overflow: hidden; font-family: 'Segoe UI', sans-serif;
            background-color: #f8f9fa; color: var(--text-dark);
        }

        body { display: flex; flex-direction: column; padding: 10px; gap: 12px; box-sizing: border-box; }

        .card {
            background: white; border: 1px solid var(--border-color);
            border-radius: 4px; display: flex; flex-direction: column;
            overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .section-header {
            background-color: var(--sheet-green); color: white;
            padding: 6px; font-weight: bold; text-align: center;
            font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;
        }

        /* G√ìRA */
        .top-row { display: grid; grid-template-columns: 160px 1fr 1fr 1fr; gap: 12px; height: 70px; flex-shrink: 0; }
        .budget-table { width: 100%; height: 100%; border-collapse: collapse; font-size: 11px; }
        .budget-table td { border: 1px solid var(--border-color); padding: 2px 6px; }
        .stat-val { display: flex; align-items: center; justify-content: center; height: 100%; font-size: 22px; font-weight: bold; }

        /* FORMULARZ */
        .input-row { height: 115px; flex-shrink: 0; border: 1px solid var(--sheet-green); }
        .sheet-table { width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed; }
        .sheet-table th { background: var(--light-green); border: 1px solid var(--border-color); padding: 8px; color: var(--sheet-green); }
        .input-field { width: 100%; border: none; padding: 12px 8px; font-size: 14px; background: transparent; outline: none; font-weight: 500; }
        .input-field:focus { background-color: #fff9c4; } 
        
        .btn-save { 
            background: var(--sheet-green); color: white; border: none; 
            padding: 10px 25px; cursor: pointer; border-radius: 4px; 
            font-weight: bold; font-size: 13px; white-space: nowrap;
        }

        /* ≈öRODEK */
        .middle-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; flex: 1; min-height: 0; }
        .scroll-area { overflow-y: auto; height: 100%; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 12px; table-layout: fixed; }
        .data-table td { border-bottom: 1px solid var(--border-color); padding: 8px; word-wrap: break-word; }
        .val-black { text-align: right; font-weight: 600; color: var(--text-dark); }

        /* D√ì≈Å */
        .charts-row { display: grid; grid-template-columns: 1.5fr 1fr; gap: 12px; height: 180px; flex-shrink: 0; }

/* TWOJA NOWA DOPISKA: */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
        }
        input[type=number] {
        -moz-appearance: textfield;
        }
    </style>
</head>
<body>

    <div class="top-row">
        <div class="card">
            <div class="section-header">üóìÔ∏è Bud≈ºet</div>
            <table class="budget-table">
                <tr><td style="background:var(--light-green)">MiesiƒÖc</td><td style="text-align:center; font-weight:bold">Stycze≈Ñ</td></tr>
                <tr><td style="background:var(--light-green)">Rok</td><td style="text-align:center; font-weight:bold">2026</td></tr>
            </table>
        </div>
        <div class="card"><div class="section-header">üí∞ Przychody</div><div class="stat-val" style="color:var(--income-blue)">{{ suma_przychodow|floatformat:2 }} z≈Ç</div></div>
        <div class="card"><div class="section-header">üìâ Wydatki</div><div class="stat-val" style="color:var(--expense-red)">{{ suma_wydatkow|floatformat:2|cut:"-" }} z≈Ç</div></div>
        <div class="card"><div class="section-header">‚úÖ Bilans</div><div class="stat-val" style="color:var(--sheet-green)">{{ bilans|floatformat:2 }} z≈Ç</div></div>
    </div>

    <div class="card input-row">
        <div class="section-header">‚ûï WPISZ WYDATEK</div>
        <form method="post" style="display:flex; height: 100%; padding: 0 15px; align-items: center; gap: 15px;">
            {% csrf_token %}
            <table class="sheet-table" style="flex:1">
                <thead>
                    <tr>
                        <th style="width:130px">Data</th>
                        <th style="width:200px">Nazwa wydatku</th>
                        <th style="width:100px">Kwota</th>
                        <th style="width:130px">Kategoria</th>
                        <th style="width:120px">Osoba</th>
                        <th style="width:120px">Informacje (dodatkowy opis)</th> </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="date" name="data_wydatku" class="input-field" value="{{ dzisiejsza_data }}"></td>
                        <td><input type="text" name="nazwa" class="input-field" placeholder="np. Zakupy" required></td>
                        <td><input type="number" step="0.01" name="kwota" class="input-field" placeholder="0.00" required onkeydown="return event.keyCode !== 69 && event.keyCode !== 89"></td>
                        <td>
                            <select name="kategoria" class="input-field" required>
                                <option value="" disabled selected>Wybierz...</option>
                                {% for kat in kategorie %}<option value="{{ kat.id }}">{{ kat.nazwa }}</option>{% endfor %}
                            </select>
                        </td>
                        <td>
                            <select name="uzytkownik" class="input-field" required>
                                <option value="" disabled selected>Wybierz...</option>
                                {% for user in uzytkownicy %}<option value="{{ user.id }}">{{ user.username }}</option>{% endfor %}
                            </select>
                        </td>
                        <td><input type="text" name="notatki" class="input-field" placeholder="Dodaj szczeg√≥≈Çy..."></td>
                    </tr>
                </tbody>
            </table>
            <div><button type="submit" class="btn-save">ZAPISZ WPIS</button></div>
        </form>
    </div>

    <div class="middle-row">
        <div class="card">
            <div class="section-header">üîÑ Przep≈Çywy</div>
            <div class="scroll-area">
                <table class="data-table">
                    <tr><td>Przychody ≈ÇƒÖczone</td><td style="text-align:right; color:var(--income-blue); font-weight:bold">+{{ suma_przychodow|floatformat:2 }}</td></tr>
                    <tr><td>Suma wydatk√≥w sta≈Çych</td><td class="val-black">-{{ suma_stale|floatformat:2|cut:"-" }}</td></tr>
                    <tr><td>Suma wydatk√≥w zmiennych</td><td class="val-black">-{{ suma_zmienne|floatformat:2|cut:"-" }}</td></tr>
                </table>
            </div>
        </div>
        <div class="card">
            <div class="section-header">üõí Wydatki zmienne</div>
            <div class="scroll-area">
                <table class="data-table">
                    {% for w in wydatki_zmienne %}
                    <tr>
                        <td>{{ w.nazwa }}<br><small style="color:#888">{{ w.data_wydatku|date:"d.m" }} {% if w.notatki %}| {{ w.notatki }}{% endif %}</small></td>
                        <td class="val-black">-{{ w.kwota|floatformat:2|cut:"-" }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        <div class="card">
            <div class="section-header">üìë Rachunki sta≈Çe</div>
            <div class="scroll-area">
                <table class="data-table">
                    {% for w in wydatki_stale %}
                    <tr>
                        <td>{{ w.nazwa }}<br><small style="color:#888">{{ w.data_wydatku|date:"d.m" }} {% if w.notatki %}| {{ w.notatki }}{% endif %}</small></td>
                        <td class="val-black">-{{ w.kwota|floatformat:2|cut:"-" }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>

    <div class="charts-row">
        <div class="card" style="padding:5px"><canvas id="barChart"></canvas></div>
        <div class="card" style="padding:5px"><canvas id="pieChart"></canvas></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const clean = (val) => Math.abs(parseFloat(val.toString().replace(',', '.')) || 0);
        const opt = { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } };
        new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: { labels: ['Wp≈Çywy', 'Sta≈Çe', 'Zmienne'], datasets: [{ data: [clean("{{ suma_przychodow }}"), clean("{{ suma_stale }}"), clean("{{ suma_zmienne }}")], backgroundColor: ['#185abc', '#5f6368', '#f9ab00'] }] },
            options: opt
        });
        new Chart(document.getElementById('pieChart'), {
            type: 'doughnut',
            data: { labels: ['Sta≈Çe', 'Zmienne'], datasets: [{ data: [clean("{{ suma_stale }}"), clean("{{ suma_zmienne }}")], backgroundColor: ['#5f6368', '#f9ab00'] }] },
            options: { ...opt, plugins: { legend: { display: true, position: 'right' } } }
        });
    </script>
</body>
</html>